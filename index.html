<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STVOR SDK ‚Äî Documentation</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --bg-main: #ffffff;
      --bg-secondary: #f8fafc;
      --border: #e2e8f0;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #64748b;
      --success: #059669;
      --danger: #dc2626;
      --warning: #f59e0b;
      --sidebar-width: 280px;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: var(--text-primary);
      background: var(--bg-secondary);
      margin: 0;
    }
    
    .layout { display: flex; min-height: 100vh; }
    
    .sidebar {
      width: var(--sidebar-width);
      background: var(--bg-main);
      border-right: 1px solid var(--border);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      padding: 24px 0;
    }
    .sidebar-header {
      padding: 0 24px 24px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 24px;
    }
    .logo {
      font-size: 24px;
      font-weight: 800;
      color: var(--text-primary);
      text-decoration: none;
      display: block;
      margin-bottom: 4px;
    }
    .logo-tagline {
      font-size: 12px;
      color: var(--text-muted);
      font-weight: 500;
    }
    .nav-section { margin-bottom: 24px; }
    .nav-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 0 24px 8px;
      letter-spacing: 0.5px;
    }
    .nav-item {
      display: block;
      padding: 8px 24px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }
    .nav-item:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }
    .nav-item.active {
      color: var(--primary);
      border-left-color: var(--primary);
      background: #eff6ff;
    }
    
    .main-content {
      margin-left: var(--sidebar-width);
      flex: 1;
    }
    .topbar {
      background: var(--bg-main);
      border-bottom: 1px solid var(--border);
      padding: 12px 32px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .tabs { display: flex; gap: 24px; }
    .tab {
      padding: 8px 0;
      font-size: 14px;
      color: var(--text-muted);
      text-decoration: none;
      border-bottom: 2px solid transparent;
    }
    .tab:hover { color: var(--text-primary); }
    .tab.active { color: var(--primary); border-bottom-color: var(--primary); }
    
    .content { max-width: 900px; padding: 48px 32px; }
    
    header { margin-bottom: 40px; }
    header h1 { font-size: 48px; font-weight: 800; margin-bottom: 12px; }
    .tagline { font-size: 20px; color: var(--text-secondary); }
    
    .intro-card {
      background: linear-gradient(135deg, #eff6ff 0%, #f8fafc 100%);
      border: 1px solid #bfdbfe;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }
    
    h2 {
      font-size: 28px;
      font-weight: 700;
      margin: 48px 0 16px 0;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    h2:first-of-type { border-top: none; margin-top: 0; }
    h3 { font-size: 18px; margin: 24px 0 12px 0; }
    p { margin: 0 0 16px 0; color: var(--text-secondary); }
    
    .card {
      background: white;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 24px;
      margin: 16px 0;
    }
    
    ul { margin: 0 0 20px 0; padding-left: 24px; color: #475569; }
    li { margin-bottom: 8px; }
    
    .code-block {
      position: relative;
      margin: 16px 0;
    }
    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #334155;
      color: #e2e8f0;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      opacity: 0.8;
      transition: all 0.2s;
    }
    .copy-btn:hover { opacity: 1; background: #475569; }
    .copy-btn.copied { background: var(--success); }
    
    pre {
      background: #0f172a;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 14px;
      line-height: 1.6;
      margin: 0;
    }
    code { font-family: 'SF Mono', Monaco, 'Courier New', monospace; }
    
    .btn {
      display: inline-block;
      padding: 12px 24px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
    }
    .btn-primary { background: #2563eb; color: white; }
    .btn-primary:hover { background: #1d4ed8; }
    .btn-secondary { background: #e2e8f0; color: #334155; margin-left: 8px; }
    .btn-secondary:hover { background: #cbd5e1; }
    
    .warning {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 12px 16px;
      border-radius: 0 6px 6px 0;
      margin: 16px 0;
      font-size: 14px;
      color: #92400e;
    }
    .success-box {
      background: #ecfdf5;
      border: 1px solid #a7f3d0;
      border-radius: 8px;
      padding: 24px;
      margin: 16px 0;
    }
    
    .step {
      display: flex;
      gap: 16px;
      margin: 24px 0;
      padding: 20px;
      background: white;
      border: 1px solid var(--border);
      border-radius: 8px;
    }
    .step-number {
      width: 32px;
      height: 32px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }
    .step-content { flex: 1; }
    .step-content h4 { margin: 0 0 8px 0; }
    
    footer {
      margin-top: 64px;
      padding-top: 24px;
      border-top: 1px solid #e2e8f0;
      text-align: center;
      color: #94a3b8;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="layout">
    
    <!-- SIDEBAR -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="#" class="logo">STVOR</a>
        <div class="logo-tagline">E2EE SDK v2.2.2</div>
      </div>
      
      <div class="nav-section">
        <div class="nav-title">Getting Started</div>
        <a href="#overview" class="nav-item active">Overview</a>
        <a href="#installation" class="nav-item">Installation</a>
        <a href="#quickstart" class="nav-item">Quick Start</a>
        <a href="#full-example" class="nav-item">Full Example</a>
      </div>
      
      <div class="nav-section">
        <div class="nav-title">Core Concepts</div>
        <a href="#security" class="nav-item">Security Model</a>
        <a href="#limitations" class="nav-item">Limitations</a>
      </div>
      
      <div class="nav-section">
        <div class="nav-title">Resources</div>
        <a href="/dashboard.html" class="nav-item">Dashboard</a>
        <a href="https://github.com/izahii/stvor-api" class="nav-item" target="_blank">GitHub ‚Üí</a>
      </div>
    </nav>
    
    <!-- MAIN CONTENT -->
    <div class="main-content">
      
      <!-- TOPBAR -->
      <div class="topbar">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div class="tabs">
            <a href="#overview" class="tab active">Docs</a>
            <a href="#full-example" class="tab">Examples</a>
          </div>
          <a href="/dashboard.html" class="btn btn-primary" style="padding: 8px 16px; font-size: 14px;">
            Open Dashboard ‚Üí
          </a>
        </div>
      </div>
      
      <!-- CONTENT -->
      <div class="content">
        
        <!-- HEADER -->
        <header id="overview">
          <h1>STVOR SDK</h1>
          <p class="tagline">Signal-style E2EE for your app ‚Äî minimal API</p>
        </header>

        <div class="intro-card">
          <p><strong>STVOR</strong> provides end-to-end encryption using the Signal Protocol (X3DH + Double Ratchet). Messages are encrypted on the client ‚Äî the server never sees plaintext.</p>
          <div style="margin-top: 16px; display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <div>
              <strong style="color: var(--success);">‚úÖ Good for:</strong>
              <ul style="margin: 8px 0 0 20px; padding: 0;">
                <li>Startups & MVPs</li>
                <li>Internal tools</li>
                <li>Pilot projects</li>
              </ul>
            </div>
            <div>
              <strong style="color: var(--danger);">‚ùå Not for:</strong>
              <ul style="margin: 8px 0 0 20px; padding: 0;">
                <li>Healthcare/Finance</li>
                <li>Mobile apps</li>
                <li>Multi-instance prod</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- INSTALLATION -->
        <h2 id="installation">Installation</h2>
        
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-content">
            <h4>Install the SDK</h4>
            <div class="code-block">
              <button class="copy-btn" onclick="copyCode(this)">Copy</button>
              <pre><code>npm install @stvor/sdk</code></pre>
            </div>
          </div>
        </div>

        <div class="warning" style="margin-top: 12px;">
          <strong>‚ö†Ô∏è Node.js Only (v2.2.x)</strong><br>
          This version requires <code>ws</code> for WebSocket transport. Browser support coming in v2.3.
          <div class="code-block" style="margin-top: 12px;">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code>npm install ws</code></pre>
          </div>
        </div>

        <!-- QUICK START -->
        <h2 id="quickstart">Quick Start (v2.3.1)</h2>
        <p>The simplest example ‚Äî connect two users and send an encrypted message:</p>
        
        <div class="success-box" style="margin-bottom: 20px;">
          <h4 style="margin: 0 0 8px 0; color: var(--success);">‚ú® New in v2.3.1</h4>
          <p style="margin: 0;">The SDK now <strong>auto-waits</strong> for recipients. No more <code>setTimeout</code> hacks!</p>
        </div>
        
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>import { createApp } from '@stvor/sdk';

// Initialize
const app = await createApp({
  appToken: 'stvor_demo_token',
  relayUrl: 'ws://localhost:8080'  // Your relay server
});

// Connect users
const alice = await app.connect('alice@example.com');
const bob = await app.connect('bob@example.com');

// Setup message handler
bob.onMessage((from, msg) => {
  console.log(`üì© ${from}: ${msg}`);
});

// send() now auto-waits for recipient (up to 10s timeout)
await alice.send('bob@example.com', 'Hello Bob! üîê');
console.log('‚úÖ Message sent!');</code></pre>
        </div>
        
        <h3>Explicit Readiness Control</h3>
        <p>For more control, use <code>waitForUser()</code> and <code>onUserAvailable()</code>:</p>
        
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>// Option 1: Explicit wait before sending
await alice.waitForUser('bob@example.com');
await alice.send('bob@example.com', 'Hello!');

// Option 2: React to user availability
alice.onUserAvailable((userId) => {
  console.log(`${userId} is now online and ready for messages`);
});

// Option 3: Check synchronously
if (alice.isUserAvailable('bob@example.com')) {
  await alice.send('bob@example.com', 'Hello!');
}

// Option 4: Skip auto-wait (throws immediately if not available)
await alice.send('bob@example.com', 'Hello!', { waitForRecipient: false });

// Option 5: Custom timeout
await alice.send('bob@example.com', 'Hello!', { timeout: 30000 });</code></pre>
        </div>

        <!-- FULL EXAMPLE -->
        <h2 id="full-example">Full Working Example</h2>
        <p>Copy these files to get E2EE working in 2 minutes:</p>

        <h3>Step 1: Create relay-server.mjs</h3>
        
        <div class="warning">
          <strong>‚ö†Ô∏è Demo Transport Only</strong><br>
          This relay server is a minimal example for local development. It is NOT the STVOR API ‚Äî it's a simple WebSocket forwarder to help you test encryption. For production, you'll need proper auth, persistence, and scaling.
        </div>
        
        <p>The relay server forwards encrypted messages between clients. It cannot decrypt anything.</p>
        
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>// relay-server.mjs
import WebSocket, { WebSocketServer } from 'ws';

const PORT = 8080;
const wss = new WebSocketServer({ port: PORT });
console.log(`üîå Relay running on ws://localhost:${PORT}`);

const clients = new Map();
const pubkeys = new Map();

wss.on('connection', (ws) => {
  // Send all known keys to new client
  for (const [user, pub] of pubkeys.entries()) {
    ws.send(JSON.stringify({ type: 'announce', user, pub }));
  }

  ws.on('message', (data) => {
    let msg;
    try { msg = JSON.parse(data.toString()); } catch { return; }

    if (msg.type === 'announce' && msg.user) {
      clients.set(msg.user, ws);
      pubkeys.set(msg.user, msg.pub);
      // Broadcast to all
      for (const [_, client] of clients) {
        if (client.readyState === WebSocket.OPEN) {
          client.send(JSON.stringify({ 
            type: 'announce', 
            user: msg.user, 
            pub: msg.pub 
          }));
        }
      }
    }

    if (msg.type === 'message' && msg.to) {
      const target = clients.get(msg.to);
      if (target && target.readyState === WebSocket.OPEN) {
        target.send(JSON.stringify(msg));
      }
    }
  });
});</code></pre>
        </div>

        <h3>Step 2: Create app.mjs</h3>
        <p>Your application code with E2EE messaging:</p>
        
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>// app.mjs
import { createApp } from '@stvor/sdk';

async function main() {
  const app = await createApp({
    appToken: 'stvor_demo_token',
    relayUrl: 'ws://localhost:8080'
  });

  // Connect Bob (receiver)
  const bob = await app.connect('bob@example.com');
  bob.onMessage((from, msg) => {
    console.log(`üì© [Bob] from ${from}: ${msg}`);
  });

  // Connect Alice (sender)
  const alice = await app.connect('alice@example.com');
  alice.onMessage((from, msg) => {
    console.log(`üì© [Alice] from ${from}: ${msg}`);
  });

  // SDK auto-waits for recipient keys (no setTimeout needed!)
  await alice.send('bob@example.com', 'Hello Bob! This is E2EE! üîê');
  console.log('‚úÖ Alice sent message');

  // Bob replies
  await bob.send('alice@example.com', 'Hi Alice! Got it! üéâ');
  console.log('‚úÖ Bob sent message');

  // Keep alive to see messages
  await new Promise(r => setTimeout(r, 1000));
}

main().catch(console.error);</code></pre>
        </div>

        <h3>Step 3: Create package.json</h3>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code>{
  "name": "my-e2ee-app",
  "type": "module",
  "dependencies": {
    "@stvor/sdk": "^2.3.1",
    "ws": "^8.13.0"
  }
}</code></pre>
        </div>

        <h3>Step 4: Run it!</h3>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code># Terminal 1: Start relay
node relay-server.mjs

# Terminal 2: Run app
npm install
node app.mjs</code></pre>
        </div>

        <div class="success-box">
          <h4 style="margin: 0 0 12px 0; color: var(--success);">‚úÖ Expected Output:</h4>
          <pre style="background: #064e3b; margin: 0; padding: 16px;"><code>‚úÖ Alice sent message
‚úÖ Bob sent message
üì© [Bob] from alice@example.com: Hello Bob! This is E2EE! üîê
üì© [Alice] from bob@example.com: Hi Alice! Got it! üéâ</code></pre>
        </div>

        <!-- SECURITY -->
        <h2 id="security">Security Model</h2>
        
        <div class="success-box">
          <h3 style="margin: 0 0 16px 0; color: var(--success);">‚úÖ What STVOR Guarantees</h3>
          <ul style="margin: 0; color: var(--text-primary);">
            <li><strong>End-to-end encryption</strong> ‚Äî plaintext never leaves the device</li>
            <li><strong>Forward Secrecy</strong> ‚Äî compromise of current keys doesn't expose past messages</li>
            <li><strong>Post-Compromise Security</strong> ‚Äî after key rotation, attacker loses access</li>
            <li><strong>Zero-knowledge relay</strong> ‚Äî server cannot decrypt messages</li>
          </ul>
        </div>

        <div class="warning">
          <strong>‚ö†Ô∏è TOFU Model:</strong> First contact requires user verification. After first contact, strong MITM protection is active. For high-security scenarios, verify fingerprints out-of-band.
        </div>

        <!-- LIMITATIONS -->
        <h2 id="limitations">Limitations</h2>
        
        <div class="card">
          <h4 style="margin-top: 0;">Known Limitations (v2.2.2)</h4>
          <ul style="margin-bottom: 0;">
            <li><strong>In-memory keys:</strong> Lost on app restart</li>
            <li><strong>Single-instance only:</strong> No distributed state</li>
            <li><strong>No mobile support:</strong> Node.js only</li>
            <li><strong>Demo-level replay protection:</strong> In-memory nonce cache</li>
            <li><strong>No multi-device:</strong> Each device = separate identity</li>
          </ul>
        </div>

        <div class="card" style="background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%); border-color: #fde047;">
          <h4 style="margin-top: 0;">Honest Positioning</h4>
          <p style="margin-bottom: 0;">STVOR is a <strong>practical reference implementation</strong>. Production-grade crypto (Signal Protocol), but demo-level infrastructure. Perfect for learning, prototypes, and low-risk applications.</p>
        </div>

        <footer>
          <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">STVOR SDK v2.2.2</div>
          <div>Honest cryptography, no marketing BS. (Feb 2026)</div>
        </footer>
        
      </div>
    </div>
  </div>

  <script>
    function copyCode(btn) {
      const code = btn.parentElement.querySelector('code').textContent;
      navigator.clipboard.writeText(code).then(() => {
        btn.textContent = '‚úì Copied!';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'Copy';
          btn.classList.remove('copied');
        }, 2000);
      });
    }

    document.querySelectorAll('.nav-item, .tab').forEach(link => {
      link.addEventListener('click', function(e) {
        const href = this.getAttribute('href');
        if (href && href.startsWith('#')) {
          e.preventDefault();
          const target = document.querySelector(href);
          if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }
      });
    });
    
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
            if (item.getAttribute('href') === '#' + entry.target.id) {
              item.classList.add('active');
            }
          });
        }
      });
    }, { threshold: 0.3, rootMargin: '-100px 0px -50% 0px' });
    
    document.querySelectorAll('h2[id], header[id]').forEach(section => {
      observer.observe(section);
    });
  </script>
</body>
</html>
